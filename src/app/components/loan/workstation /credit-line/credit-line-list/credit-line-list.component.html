<div class="w-100 pb-0 p-3">
  @if (!showCreditLine) {
    <main class="bg-white">
      <section class="sm-radius p-2">
        <app-list
          [addButtonLink]="{
            url: '/w/workstation/d/desk/credit/creditsline/list',
            fragment: 'creditLine',
          }"
          [headers]="headers"
          url="/clients/manage/creditline/?"></app-list>
      </section>
    </main>
  }

  @if (showCreditLine) {
    <div class="p-2 py-4 sm-radius" id="creditLine">
      <div class="text-dark p-4">
        <div class="p-4 bg-white sm-radius">
          <div class="d-grid">
            <div class="d-flex align-items-center gap-2">
              <div
                class="primary-light rounded-circle"
                style="width: 10px; height: 10px"></div>
              <div class="fw-bold" i18n>Account & Credit Line Information</div>
            </div>
            <form [formGroup]="myForm">
              <div class="row">
                <div class="d-grid col">
                  <div class="">
                    <div class="d-flex justify-content-center w-50">
                      <app-lookup
                        class="w-100 mt-2"
                        option="autocomplete"
                        (selectedItemEvent)="getClientId($event)"
                        url="/clients/manage/accounts/objects_autocomplete?search="
                        label="Enter the client account"></app-lookup>
                    </div>
                  </div>
                  <div class="form-floating mt-4">
                    <input
                      type="date"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="due"
                      formControlName="due"
                      placeholder="due" />
                    <label for="due" class="text-dark" i18n> Due date </label>
                  </div>
                  <div class="form-floating mt-4">
                    <input
                      type="text"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="debitor"
                      formControlName="debitor"
                      placeholder="debitor"
                      (input)="checkDebitorValue()" />
                    <label for="debitor" class="text-dark" i18n
                      >Debitor rate %</label
                    >
                  </div>
                  <div *ngIf="isDebitorGreaterThan100" class="mt-2 text-danger">
                    Debitor rate should be less than 100.
                  </div>

                  <div class="form-floating mt-4">
                    <input
                      type="text"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="penalities"
                      formControlName="penalities"
                      placeholder="penalities"
                      (input)="checkPenalitiesValue()" />
                    <label for="penalities" class="text-dark" i18n
                      >Penalities rate %</label
                    >
                  </div>
                  <!-- <div class="d-flex gap-4 mt-3">
                                  <div>min:1</div>
                                  <div>max:99</div>
                              </div> -->

                  <div
                    *ngIf="isPenalitiesGreaterThan100"
                    class="mt-2 text-danger">
                    Penalities rate should be less than 100.
                  </div>
                </div>

                <div class="col">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="amount"
                      formControlName="amount"
                      placeholder="amount" />
                    <label for="amount" class="text-dark" i18n>Amount </label>
                  </div>
                  <div class="form-floating mt-4">
                    <input
                      type="date"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="facility"
                      formControlName="facility"
                      placeholder="facility"
                      (focusout)="checkFacilityDue()" />
                    <label for="contribution" class="text-dark" i18n
                      >Facility Date</label
                    >
                  </div>

                  <div
                    *ngIf="isFacilityGreaterThanDue"
                    class="mt-2 text-danger">
                    Facility date must be lower than Due date.
                  </div>

                  <div class="form-floating mt-4">
                    <input
                      type="text"
                      class="input form-control text-dark simulator-input w-50 border"
                      id="fees"
                      formControlName="fees"
                      placeholder="fees" />
                    <label for="fees" class="text-dark" i18n>Fees </label>
                  </div>
                  <div class="d-flex align-items-center gap-4">
                    <div class="mt-3">
                      <label
                        (click)="toggleCheckbox()"
                        tabindex="0"
                        for="isRenewable"
                        class="d-flex align-items-center gap-2"
                        role="button">
                        <span *ngIf="isChecked">
                          <i
                            class="fa-regular fa-square-check fs-4 text-primary"></i>
                        </span>
                        <span *ngIf="!isChecked">
                          <i class="fa-regular fa-square fs-4"></i>
                        </span>
                        <span class="text-dark" i18n> % </span>
                      </label>
                    </div>
                    <div class="mt-3" *ngIf="isChecked">
                      <i class="fa-solid fa-play text-primary"></i>
                      {{ calculateValue() }}
                    </div>
                  </div>
                </div>

                <div>
                  <div class="form-floating mt-4">
                    <textarea
                      type="text"
                      class="border input form-control bg-light text-dark simulator-input p-5 w-75"
                      id="description"
                      formControlName="description"
                      placeholder="Description">
                    </textarea>

                    <label for="description" class="text-dark" i18n
                      >Add comment</label
                    >
                  </div>
                </div>
                <div class="d-flex justify-content-center w-75 mt-3">
                  <div
                    class="btn bg-primary sm-radius text-white px-5"
                    (click)="openModal()"
                    tabindex="0"
                    [ngClass]="{
                      'not-clickable':
                        !myForm.valid ||
                        isLoading ||
                        isDebitorGreaterThan100 ||
                        isPenalitiesGreaterThan100 ||
                        !lookupEffectue ||
                        isFacilityGreaterThanDue,
                    }">
                    <div>Confirm</div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  }
</div>
