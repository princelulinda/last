<main class="p-2">
  <header>
    <div>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center">
          <span class="fs-5 me-2">
            <i class="fa fa-sliders text-primary"></i>
          </span>
          <b
            class="sub-title me-3"
            [ngClass]="{
              'text-dark': theme === 'dark-mode',
            }"
            i18n
            >Merchant configuration</b
          >
          <span
            [ngClass]="merchantInfo ? 'clickable' : 'not-clickable'"
            (click)="switchMenu('detail')"
            tabindex="0"
            *ngIf="!selected"
            role="button"
            title="Edit merchant information">
            <i class="fa-solid fa-pen"></i>
          </span>
        </div>
        <div class="">
          <span
            [ngClass]="{
              'text-dark': theme === 'dark-mode',
            }"
            class="d-flex align-items-center back-md"
            role="button"
            (click)="goBack()"
            tabindex="0">
            <span class="me-1">
              <i class="fa fa-arrow-left"></i>
            </span>
            <b class="fs-4" i18n>Back</b>
          </span>
        </div>
      </div>
    </div>
  </header>
  <div>
    <div class="mt-4 ms-4" *ngIf="!merchantInfo">
      <span
        class="w-100 h-100 d-flex row align-items-center text-dark"
        title="Loading merchant info ...">
        <i class="spinner-border"></i>
      </span>
    </div>
    <section class="mt-4 row" *ngIf="!selected">
      <div class="row" *ngIf="merchantInfo">
        <div class="col-lg-6">
          <div *ngIf="merchantInfo" class="d-grid">
            <div>
              <div class="text-secondary" i18n>Name</div>
              <b class="fw-bold text-dark">
                {{ merchantInfo.merchant_title }}
              </b>
            </div>

            <div class="mt-2">
              <div class="text-secondary" i18n>Category</div>
              <b class="fw-bold text-dark">
                {{ merchantInfo?.merchant_category?.name }}
              </b>
            </div>
            <div class="mt-2">
              <div class="text-secondary" i18n>Slug</div>
              <b class="fw-bold text-dark fs-6">{{ merchantInfo.slug }} </b>
            </div>

            <div class="mt-2">
              <div class="text-secondary" i18n>APi plug name</div>
              <b class="fw-bold text-dark fs-6"> ---- </b>
            </div>

            <div class="mt-2">
              <div class="text-secondary" i18n>Accepts cart</div>
              <div>
                <span *ngIf="merchantInfo.accepts_cart">
                  <i class="fa-solid fa-circle-check text-success"></i>
                </span>
                <span *ngIf="!merchantInfo.accepts_cart">
                  <i class="fa-solid fa-circle-xmark text-danger"></i>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="d-grid">
            <div class="d-flex gap-2">
              <div class="text-secondary" i18n>Logo</div>
              <div
                style="width: 96px; height: 96px"
                class="overflow-hidden lg-radius">
                <img
                  *ngIf="!merchantInfo.merchant_logo"
                  src="../../../../assets/images/userprofile.png"
                  alt=""
                  class="img-fluid lg-radius" />

                <img
                  *ngIf="merchantInfo.merchant_logo"
                  [src]="merchantInfo.merchant_logo"
                  alt=""
                  class="img-fluid lg-radius" />
              </div>
            </div>
            <div class="mt-2">
              <div class="text-secondary" i18n>Accept simple payment</div>
              <div>
                <span *ngIf="merchantInfo.accepts_simple_payment">
                  <i class="fa-solid fa-circle-check text-success"></i>
                </span>
                <span *ngIf="!merchantInfo.accepts_simple_payment">
                  <i class="fa-solid fa-circle-xmark text-success"></i>
                </span>
              </div>
            </div>
            <div class="mt-2">
              <div class="text-secondary" i18n>Incognito</div>
              <div>
                <span *ngIf="merchantInfo.client_visibility_activated">
                  <i class="fa-solid fa-circle-check text-success"></i>
                </span>
                <span *ngIf="!merchantInfo.client_visibility_activated">
                  <i class="fa-solid fa-circle-xmark text-danger"></i>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4"></div>
      </div>
    </section>

    <div *ngIf="selected === 'detail'">
      <section
        [formGroup]="merchantConfigForm"
        [ngClass]="{
          'not-clickable': isLoading,
        }"
        *ngIf="merchantInfo">
        <div class="row w-75">
          <div class="d-grid col-lg-6 mb-4">
            <div class="form-floating mb-4">
              <input
                type="text"
                class="input border form-control bg-input"
                [ngClass]="{
                  'border-secondary': theme === 'light-mode',
                  'border-dark bg-white text-dark': theme === 'dark-mode',
                }"
                id="name"
                placeholder="name"
                formControlName="name" />
              <label
                for="name"
                class="label-input"
                [ngClass]="{
                  'text-dark': theme === 'dark-mode',
                }"
                >Name</label
              >
            </div>

            <div class="d-flex align-items-center gap-3 mb-4">
              <b class="text-dark"> Location</b>
              <div
                class="w-100 p-3 rounded bg-primary d-flex justify-content-between">
                <div class="text-all-white">Open map</div>

                <div>
                  <i class="fas fa-street-view fs-4 text-all-white"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <label for="merchantLogo">
              <div
                class="lg-radius d-flex level-1 text-secondary ms-5 border justify-content-center align-items-center merchant-container"
                style="width: 138px; height: 150px; position: relative">
                <img
                  *ngIf="!merchantInfo.merchant_logo && !previewImage"
                  src="../../../../assets/images/userprofile.png"
                  alt=""
                  class="img-fluid lg-radius merchant-logo" />

                <img
                  *ngIf="merchantInfo.merchant_logo && !previewImage"
                  [src]="merchantInfo.merchant_logo"
                  alt=""
                  class="img-fluid lg-radius merchant-logo" />
              </div>
            </label>
          </div>
        </div>
        <div class="row w-75">
          <div class="form-floating mb-4 col-lg-6">
            <input
              type="text"
              class="input border form-control bg-input"
              [ngClass]="{
                'border-secondary': theme === 'light-mode',
                'border-dark bg-white text-dark': theme === 'dark-mode',
              }"
              id="slug"
              placeholder="slug"
              formControlName="slug" />
            <label
              for="slug"
              class="label-input ms-label"
              [ngClass]="{
                'text-dark': theme === 'dark-mode',
              }"
              >Slug</label
            >
          </div>
        </div>
        <div class="mt-3">
          <div class="fw-bold text-dark">
            <div
              class="form-check form-switch d-flex justify-content-between w-75">
              <div class="col-12 d-flex justify-content-between">
                <div class="mt-3 d-flex justify-content-between">
                  <div
                    class="d-flex w-100 justify-content-start align-items-center mb-3">
                    <b class="text-md-sm me-3">Accept simple payment</b>
                    <div
                      role="button"
                      (click)="
                        toggleProductSwitchBox(
                          'simple_payment',
                          merchantConfigForm.value.simplePayment
                            ? 'not_accepts_simple_payment'
                            : 'accepts_simple_payment'
                        )
                      "
                      tabindex="0"
                      class="switch d-flex align-items-center px-1 text-all-white"
                      [ngClass]="
                        merchantConfigForm.value.simplePayment
                          ? 'justify-content-end bg-primary'
                          : 'justify-content-start'
                      ">
                      <span class="fa fa-circle"></span>
                    </div>
                  </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                  <div
                    class="d-flex w-100 justify-content-start align-items-center mb-3">
                    <b class="text-md-sm me-3">Accept cart</b>
                    <div
                      role="button"
                      (click)="
                        toggleProductSwitchBox(
                          'cart',
                          merchantConfigForm.value.cart
                            ? 'not_accepts_cart'
                            : 'accepts_cart'
                        )
                      "
                      tabindex="0"
                      class="switch d-flex align-items-center px-1 text-all-white"
                      [ngClass]="
                        merchantConfigForm.value.cart
                          ? 'justify-content-end bg-primary'
                          : 'justify-content-start'
                      ">
                      <span class="fa fa-circle"></span>
                    </div>
                  </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                  <div
                    class="d-flex w-100 justify-content-start align-items-center mb-3">
                    <b class="text-md-sm me-3">Incognito</b>
                    <div
                      role="button"
                      (click)="
                        toggleProductSwitchBox(
                          'incognito',
                          merchantConfigForm.value.incognito
                            ? 'invisible'
                            : 'visible'
                        )
                      "
                      tabindex="0"
                      class="switch d-flex align-items-center px-1 text-all-white"
                      [ngClass]="
                        merchantConfigForm.value.incognito
                          ? 'justify-content-end bg-primary'
                          : 'justify-content-start'
                      ">
                      <span class="fa fa-circle"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          class="d-flex w-75 gap-4 align-items-center mt-5 justify-content-center">
          <b role="button" (click)="selected = ''" tabindex="0">Cancel</b>

          <div class="ms-3 d-flex justify-content-center align-items-center">
            <button
              (click)="openModal()"
              [disabled]="!merchantConfigForm.dirty"
              class="btn px-5 text-all-white bg-primary">
              <span *ngIf="isLoading" class="">
                <i class="fa-solid fa-spin fa-circle-notch fs-4"></i>
              </span>
              <b *ngIf="!isLoading">Save</b>
            </button>
          </div>
        </div>
      </section>
    </div>

    <section class="mt-4">
      <div>
        <div class="d-flex align-items-center">
          <span class="me-2">
            <i style="font-size: 0.64rem" class="fa fa-circle text-primary"></i>
          </span>
          <b
            class="sub-title"
            [ngClass]="{
              'text-dark': theme === 'dark-mode',
            }"
            i18n
            >Tellers</b
          >
        </div>
      </div>
      <div class="w-100 d-flex mt-3">
        <div class="w-75 d-grid pt-2">
          <span
            class="sub-title"
            [ngClass]="{
              'text-dark': theme === 'dark-mode',
            }"
            >List</span
          >

          <hr style="margin-top: 5px" class="text-dark" />
        </div>
        <div class="w-25 mb-4 d-flex">
          <button
            [disabled]="!tellers"
            class="btn border-primary text-dark"
            data-bs-toggle="modal"
            data-bs-target="#newTellerModal"
            #closeModal
            (click)="toggleModal()">
            <b
              class="mini-title"
              [ngClass]="{
                'text-dark': theme === 'dark-mode',
              }"
              >Add teller</b
            >
          </button>
        </div>
      </div>

      <div>
        <div *ngIf="!get_tellers">
          <div class="row">
            <div
              *ngFor="let _ of [1, 2, 3]"
              class="d-flex mb-3 align-items-center col-auto">
              <div class="d-grid me-3">
                <span>
                  <app-skeleton height="130px" width="130px"></app-skeleton>
                </span>
              </div>
              <div class="d-grid">
                <span class="">
                  <app-skeleton height="10px" width="100px"></app-skeleton>
                </span>
                <span class="">
                  <app-skeleton height="10px" width="100px"></app-skeleton>
                </span>
                <span class="">
                  <app-skeleton height="10px" width="100px"></app-skeleton>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="get_tellers && tellers.length > 0" class="row">
          <div
            *ngFor="let teller of tellers"
            data-bs-toggle="modal"
            data-bs-target="#tellersModal"
            role="button"
            (click)="displayTellerInfo(teller)"
            tabindex="0"
            class="col-lg-4 col-md-6 mb-3 is-hoverable"
            role="button">
            <div class="d-flex align-items-start">
              <div
                style="height: 86px; width: 86px"
                class="me-3 overflow-hidden rounded">
                <!-- <img
                                    *ngIf="!teller.client?.picture"
                                    src="../../../../assets/images/userprofile.png"
                                    class="image rounded"
                                    alt=""
                                /> -->
                @if (!teller.client?.picture) {
                  <span
                    class="d-flex justify-content-center sm-radius bg-secondary">
                    <i
                      class="fa-solid fa-user fa-3x mb-4 mt-3"
                      style="color: #ffffff"></i>
                  </span>
                } @else if (teller.client.picture) {
                  <img
                    [src]="teller.client.picture"
                    class="image rounded"
                    alt="" />
                }
                <!-- <img
                                    *ngIf="teller.client?.picture"
                                    [src]="teller.client.picture"
                                    class="image rounded"
                                    alt=""
                                /> -->
              </div>
              <div class="d-grid pt-0-1">
                <b class="text-dark text-md">{{
                  teller?.client?.client_full_name
                }}</b>
                <b class="text-dark text-md">{{
                  teller?.client?.client_code
                }}</b>
                <div class="d-flex align-items-center">
                  <b class="me-2" *ngIf="teller.can_receive_notifications">
                    <i class="fa fa-bell"></i>
                  </b>
                  <b class="me-2" *ngIf="teller?.teller_type?.value === 'A'">
                    <i class="fa fa-user-tie"></i>
                  </b>
                  <b *ngIf="teller?.teller_type?.value === 'S'">
                    <i class="fa-brands fa-black-tie"></i>
                  </b>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="get_tellers && tellers.length === 0" class="my-4">
          <b class="text-l text-secondary">No tellers found</b>
        </div>
      </div>
    </section>
  </div>
</main>

<div class="modal fade" data-mdb-backdrop="false" id="myModal">
  <div
    class="modal-dialog w-100 d-flex justify-content-center h-100 align-items-center overflow-auto"
    style="min-width: 75%">
    <div class="modal-content w-resp">
      <app-merchant-teller-details
        [tellerInfo]="selectedTeller"
        [get_tellerInfo]="get_selectedTeller"
        (isActionDone)="getTellerOptions($event)"></app-merchant-teller-details>

      <!-- <router-outlet></router-outlet> -->
    </div>
  </div>
</div>
<!--modAL-->
<div class="modal fade" data-mdb-backdrop="false" id="newTellerModal">
  <div
    class="modal-dialog inner-container w-100 d-flex justify-content-center h-100 align-items-center overflow-auto"
    style="min-width: 75%">
    <div class="modal-content w-75 h-75">
      <main *ngIf="tellerCreationDone" class="p-4">
        <section class="">
          <div class="w-100 d-flex justify-content-between">
            <div class="mb-4">
              <span
                class="l-title"
                [ngClass]="{
                  'text-dark': theme === 'dark-mode',
                }"
                >New Teller</span
              >
            </div>
            <b
              role="button"
              data-bs-toggle="modal"
              data-bs-target="#newTellerModal">
              <i class="fa fs-4 fa-xmark"></i>
            </b>
          </div>
        </section>
        <section>
          <div
            [formGroup]="newTellerForm"
            [ngClass]="{
              'not-clickable': isTellerLoading,
            }">
            <div>
              <div class="d-flex justify-content-start mb-3">
                <app-lookup
                  class="w-resp-client"
                  option="lookup"
                  (selectedItemEvent)="getClientInfo($event)"
                  url="/clients/list/all/object_lookup?lookup_data="
                  label="Enter client id"></app-lookup>
              </div>
            </div>
            <div class="form-floating my-4 col-lg-6">
              <input
                type="text"
                class="input border form-control bg-input"
                [ngClass]="{
                  'border-secondary': theme === 'light-mode',
                  'border-dark bg-white text-dark': theme === 'dark-mode',
                }"
                id="slug"
                placeholder="alias"
                formControlName="alias" />
              <label
                for="slug"
                class="label-input ms-label"
                [ngClass]="{
                  'text-dark': theme === 'dark-mode',
                }"
                >Alias</label
              >
            </div>
            <div class="d-flex">
              <span class="me-2 text-dark text-md" i18n
                >Can receive notifications</span
              >
              <div
                role="button"
                (click)="toggleNotificationsCheckbox()"
                tabindex="0">
                <span *ngIf="isChecked">
                  <i class="fa-regular fa-square-check fs-4 text-dark"></i>
                </span>
                <span *ngIf="!isChecked">
                  <i class="fa-regular fa-square fs-4 text-dark"></i>
                </span>
              </div>
            </div>
            <div class="mt-3">
              <button
                (click)="createNewTeller()"
                [ngClass]="{
                  'not-clickable': newTellerForm.invalid,
                }"
                class="btn btn-primary px-4-5">
                <span *ngIf="isTellerLoading" class="">
                  <i class="fa-solid fa-spin fa-circle-notch fs-4"></i>
                </span>
                <b
                  [ngClass]="{
                    'text-dark': theme === 'dark-mode',
                  }"
                  *ngIf="!isTellerLoading"
                  >Confirm</b
                >
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
</div>

<div class="modal fade" data-mdb-backdrop="static" id="tellersModal">
  <div
    class="modal-dialog w-100 d-flex justify-content-center h-100 align-items-center overflow-auto"
    style="min-width: 75%">
    <div class="modal-content w-resp">
      <app-merchant-teller-details
        [tellerInfo]="selectedTeller"
        (isActionDone)="getTellerOptions($event)"></app-merchant-teller-details>

      <!-- <router-outlet></router-outlet> -->
    </div>
  </div>
</div>

<!-- <router-outlet></router-outlet> -->
